{
  "version": 3,
  "sources": ["../../../worker.js"],
  "sourceRoot": "E:\\\u4E2A\u4EBA\u7F51\u7AD9\\.wrangler\\tmp\\deploy-W62suh",
  "sourcesContent": ["/**\n * Cloudflare Worker for AI Assistant\n * \u4EE3\u7406\u8C03\u7528\u963F\u91CC\u4E91\u767E\u70BC\u5927\u6A21\u578B API\n *\n * \u90E8\u7F72\u540E\u83B7\u53D6 Worker URL\uFF0C\u586B\u5165\u7F51\u9875\u7684 API \u5730\u5740\u914D\u7F6E\u4E2D\n */\n\nconst SYSTEM_PROMPT = `\u4F60\u662F\u4E00\u4E2A\u4E2A\u4EBA\u7F51\u7AD9\u7684 AI \u52A9\u624B\uFF0C\u7531\u963F\u91CC\u4E91\u767E\u70BC\u5927\u6A21\u578B\u9A71\u52A8\u3002\n\n\u5173\u4E8E\u8FD9\u4E2A\u7F51\u7AD9\u7684\u4FE1\u606F\uFF1A\n- \u7F51\u7AD9\u4E3B\u4EBA\uFF1A\u738B\u5E05\uFF0C\u662F\u4E00\u540D\u6559\u7F16\u7A0B\u7684 AI \u8001\u5E08\n- \u7F51\u7AD9\u5185\u5BB9\uFF1A\u5305\u542B\u4E2A\u4EBA\u4ECB\u7ECD\u3001\u4F5C\u54C1\u5C55\u793A\u3001\u5B66\u5458\u4F5C\u54C1\u96C6\u3001\u8054\u7CFB\u65B9\u5F0F\u56DB\u4E2A\u90E8\u5206\n- \u6280\u672F\u6808\uFF1A\u7EAF\u9759\u6001 HTML + CSS\uFF0C\u4F7F\u7528 Apple \u98CE\u683C\u7684\u8BBE\u8BA1\u7CFB\u7EDF\n- \u8BBE\u8BA1\u98CE\u683C\uFF1A\u6DF1\u8272\u4E3B\u9898\uFF0C\u7B80\u7EA6\u7CBE\u81F4\uFF0C\u6CE8\u91CD\u7EC6\u8282\u548C\u4EA4\u4E92\u4F53\u9A8C\n- \u7279\u8272\u529F\u80FD\uFF1A\u73AF\u5883\u5149\u6548\u3001\u89C6\u5DEE\u6548\u679C\u3001\u6EDA\u52A8\u52A8\u753B\u3001AI \u52A9\u624B\n\n\u738B\u5E05\u7684\u80CC\u666F\uFF1A\n- \u8FC7\u53BB\u4E00\u5E74\u6DF1\u5EA6\u63A2\u7D22 AI \u7F16\u7A0B\u6280\u672F\n- \u4ECE\u96F6\u5F00\u59CB\u9010\u6B65\u638C\u63E1\u6700\u524D\u6CBF\u7684\u65B9\u6CD5\n- \u5E0C\u671B\u5E2E\u52A9\u6BCF\u4E2A\u4EBA\u5C06 AI \u878D\u5165\u5DE5\u4F5C\u4E0E\u751F\u6D3B\n- \u76F8\u4FE1\u4E2A\u4EBA\u80FD\u529B\u5F3A\u7684\u4EBA\u4E5F\u53EF\u4EE5\u4ECE\u4E8B\u6559\u5B66\u548C\u76C8\u5229\u5DE5\u4F5C\n\n\u8BF7\u7528\u53CB\u597D\u3001\u4E13\u4E1A\u7684\u8BED\u6C14\u56DE\u7B54\u7528\u6237\u5173\u4E8E\u7F51\u7AD9\u7684\u4EFB\u4F55\u95EE\u9898\u3002\u56DE\u7B54\u8981\u7B80\u6D01\u660E\u4E86\uFF0C\u4E00\u822C\u4E0D\u8D85\u8FC7200\u5B57\u3002`;\n\nexport default {\n  async fetch(request, env) {\n    // \u5904\u7406 CORS \u9884\u68C0\u8BF7\u6C42\n    if (request.method === 'OPTIONS') {\n      return new Response(null, {\n        headers: {\n          'Access-Control-Allow-Origin': '*',\n          'Access-Control-Allow-Methods': 'POST, OPTIONS',\n          'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n        },\n      });\n    }\n\n    // \u53EA\u5904\u7406 POST \u8BF7\u6C42\n    if (request.method !== 'POST') {\n      return new Response('Method not allowed', { status: 405 });\n    }\n\n    try {\n      const body = await request.json();\n      const { message, apiKey } = body;\n\n      if (!message || typeof message !== 'string') {\n        return new Response(\n          JSON.stringify({ error: 'Invalid message' }),\n          {\n            status: 400,\n            headers: getCorsHeaders(),\n          }\n        );\n      }\n\n      // \u4F18\u5148\u4F7F\u7528\u8BF7\u6C42\u4E2D\u7684 API Key\uFF0C\u5982\u679C\u6CA1\u6709\u5219\u4F7F\u7528\u73AF\u5883\u53D8\u91CF\n      const keyToUse = apiKey || env.DASHSCOPE_API_KEY;\n\n      if (!keyToUse) {\n        return new Response(\n          JSON.stringify({\n            error: 'API Key missing',\n            reply: '\u8BF7\u5728\u7F51\u9875\u4E2D\u914D\u7F6E API Key\uFF0C\u6216\u8054\u7CFB\u7BA1\u7406\u5458\u914D\u7F6E\u670D\u52A1\u7AEF API Key\u3002'\n          }),\n          {\n            status: 401,\n            headers: getCorsHeaders(),\n          }\n        );\n      }\n\n      // \u8C03\u7528\u963F\u91CC\u4E91\u767E\u70BC API\n      const reply = await callDashScopeAPI(message, keyToUse);\n\n      return new Response(\n        JSON.stringify({ reply }),\n        {\n          status: 200,\n          headers: getCorsHeaders(),\n        }\n      );\n\n    } catch (error) {\n      console.error('Worker Error:', error);\n      return new Response(\n        JSON.stringify({\n          error: error.message,\n          reply: '\u62B1\u6B49\uFF0CAI \u670D\u52A1\u6682\u65F6\u4E0D\u53EF\u7528\u3002\u9519\u8BEF\uFF1A' + error.message\n        }),\n        {\n          status: 500,\n          headers: getCorsHeaders(),\n        }\n      );\n    }\n  },\n};\n\nfunction getCorsHeaders() {\n  return {\n    'Content-Type': 'application/json',\n    'Access-Control-Allow-Origin': '*',\n    'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n  };\n}\n\nasync function callDashScopeAPI(userMessage, apiKey) {\n  const url = 'https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation';\n\n  const requestBody = {\n    model: 'qwen-max',\n    input: {\n      messages: [\n        { role: 'system', content: SYSTEM_PROMPT },\n        { role: 'user', content: userMessage }\n      ]\n    },\n    parameters: {\n      max_tokens: 1500,\n      temperature: 0.7,\n      top_p: 0.9,\n    }\n  };\n\n  const response = await fetch(url, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${apiKey}`,\n      'X-DashScope-SSE': 'disable'\n    },\n    body: JSON.stringify(requestBody)\n  });\n\n  if (!response.ok) {\n    const errorText = await response.text();\n    console.error('DashScope API error:', response.status, errorText);\n    throw new Error(`API \u8FD4\u56DE\u9519\u8BEF ${response.status}: ${errorText}`);\n  }\n\n  const data = await response.json();\n\n  // \u963F\u91CC\u4E91 API \u8FD4\u56DE\u683C\u5F0F: output.text\n  if (data.output && data.output.text) {\n    return data.output.text;\n  }\n\n  throw new Error('API \u8FD4\u56DE\u683C\u5F0F\u5F02\u5E38');\n}\n"],
  "mappings": "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",
  "names": []
}
